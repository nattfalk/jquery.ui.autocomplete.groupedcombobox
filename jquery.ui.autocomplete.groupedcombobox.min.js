!function(a){a.widget("custom.combobox",{_create:function(){this.wrapper=a("<span>").addClass("custom-combobox").insertAfter(this.element),this.element.hide(),this._createAutocomplete(),this._createShowAllButton()},_createAutocomplete:function(){var t=this.element.find(":selected"),e=t.val()?t.text():"";this.input=a("<input>").appendTo(this.wrapper).val(e).attr("title","").addClass("custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left").autocomplete({delay:0,minLength:0,source:a.proxy(this,"_source")}).tooltip({classes:{"ui-tooltip":"ui-state-highlight"}}),this.input.data("ui-autocomplete")._renderItem=function(t,e){return a("<li></li>").data("ui-autocomplete-item",e).append("<div>"+e.label+"</div>").appendTo(t)},this.input.data("ui-autocomplete")._renderMenu=function(i,t){var o=this,n="";a.each(t,function(t,e){e.category!==n&&(e.category&&i.append("<li class='ui-autocomplete-category'>"+e.category+"</li>"),n=e.category),o._renderItem(i,e)})},this._on(this.input,{autocompleteselect:function(t,e){e.item.option.selected=!0,this._trigger("select",t,{item:e.item.option})},autocompletechange:"_removeIfInvalid"})},_createShowAllButton:function(){var t=this.input,e=!1;a("<a>").attr("tabIndex",-1).attr("title","Show All Items").tooltip().appendTo(this.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("custom-combobox-toggle ui-corner-right").on("mousedown",function(){e=t.autocomplete("widget").is(":visible")}).on("click",function(){t.trigger("focus"),e||t.autocomplete("search","")})},_source:function(e,t){var i=new RegExp(a.ui.autocomplete.escapeRegex(e.term),"i");t(this.element.find("option").map(function(){var t=a(this).text();if(this.value&&(!e.term||i.test(t)))return{label:t,value:t,option:this,category:a(this).closest("optgroup").attr("label")}}))},_removeIfInvalid:function(t,e){if(!e.item){var i=this.input.val(),o=i.toLowerCase(),n=!1;this.element.find("option").each(function(){if(a(this).text().toLowerCase()===o)return this.selected=n=!0,!1}),n||(this.input.val("").attr("title",i+" didn't match any item").tooltip("open"),this.element.val(""),this._delay(function(){this.input.tooltip("close").attr("title","")},2500),this.input.autocomplete("instance").term="")}},_destroy:function(){this.wrapper.remove(),this.element.show()}})}(jQuery);